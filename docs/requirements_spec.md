# **小売業向け販売分析システム - 要件定義書**

## **システム概要**
### **システム名称**
**CodeIgniter 4 小売分析システム**

本システムは、基幹システムから出力された各種マスタおよび伝票のExcelファイルをSQL Serverにデータとして取り込み、販売分析に活用することを目的としています。

ファイルサイズが大きいExcelデータの取り込みに対応するため、Web画面の専用インターフェースからアップロードを行い、バックグラウンド処理でデータ登録を実行します。これにより、業務負荷を軽減し、スムーズなデータ管理を実現します。

販売分析では、伝票の情報をもとに販売動向を可視化し、原価の回収率や店舗への品出し後の週ごとの販売状況を分析します。
正確な販売データを活用することで、売れ行きの遅い商品の価格調整を検討し、売れ筋商品の選定・適切な補充発注を行い、売上の向上を促進します。

## **基幹システムについて**  
流通小売業向けMDシステム
ユニケージ・リテイル [Unicage Retail]
製造元：有限会社ユニバーサル・シェル・プログラミング研究所

### **連携(出力)データ**

#### **ファイル形式**
EXCEL形式 [.xlsx]

#### **データ種類**
**マスタ**
- 商品マスタ
- メーカーマスタ
- 色
- サイズ
- 季節

**伝票**
- 仕入伝票
- 売上伝票
- 移動伝票
- 調整伝票
- 発注伝票


 
## **機能一覧**

### **商品販売分析 - 単品集計表**
#### **機能概要**  
メーカーと品番を指定し、販売状況を分析する機能 を提供します。
サイズやカラーの違いを統合し、同一商品として集計 することで、販売データの精度を向上させます。
さらに、各種伝票データをもとに、品出し日からの販売推移を分析 し、補充発注や値引きのタイミングを最適化します。
特に、売れ行きの傾向に応じて、大幅値引きを実施し在庫を一掃する戦略 に活用できます。
この分析結果は、バイヤーが次期商品の仕入れを判断するための重要な指標 となり、需要予測の精度向上に貢献します。
過去の販売データと市場動向を組み合わせることで、より戦略的な商品選定を支援します。

#### 業務ルール
- **回収率目標**: 100%（売上が仕入金額を超えること）
- **値引きタイミング**: 4週間経過、回収率100%達成後
- **処分判定基準**: 売上が仕入金額を超過時
- **集計範囲**: 全店舗合計
- **品出し日**: 
  DC→店舗 (移動伝票の最初の受入日)
  品出し日が存在しない（対象の移動伝票は無い）場合、警告表示し仕入伝票の日付を品出し日とする
  集計結果の表には、仕入伝票の日付を利用した旨を表示する
- **仕入データと売上データの時系列整合性**: 警告表示「仕入前売上が検出されました」など

#### 店舗受入れの判断
  - **移動区分[transfer_type]**：受入
  - **振出店コード[source_store_code]**：0900 本部DC（ディストリビューションセンター）
  - **受入店コード[destination_store_code]**：0010～0500 ※移動日付[transfer_date]を品出し日とする

#### 定価について
商品マスタ[products]のM単価（税抜）[m_unit_price]

#### 原価について
仕入伝票[purchase_slip]の仕入単価（税抜）[cost_price]
　平均原価法か最終仕入原価法を選べるようにしたい

#### 懸案事項
・途中で追加仕入が発生した場合の累計回収率の計算方法
・シーズン終了で店舗から倉庫い移動し、翌年に再度、品出しした場合の対応

#### 拡張で実装したい機能
・ChatGPTのAPIを利用して、販売状況から売上分析と今後の対応についてのレポートを作成したい



### **各種マスタ取込**
#### **機能概要**  
基幹システムから出力される Excelファイル形式のマスタデータ を、データベースにインポートする機能を提供します。
ユーザーはファイルをアップロードすることで、バックグラウンドで動作する専用タスクが 伝票データや各種マスタを自動的に取込処理 します。
大量データを扱うため、非同期処理を活用することで、システム負荷を抑えながら効率的なインポート を実現します。
また、処理の進捗状況や完了結果は タスク一覧画面で確認可能 であり、ユーザーはリアルタイムで取込状況を把握できます。
これにより、業務のスムーズな継続が可能になり、データの一貫性と運用効率が向上します。


### **各種伝票取込**
#### **機能概要**  
基幹システムから出力される Excelファイル形式の伝票データ（販売履歴・発注情報など） をデータベースにインポートする機能を提供します。
ユーザーがファイルをアップロードすると、バックグラウンドで動作する専用タスクが自動的に伝票取込を実行 します。
大量の伝票データを処理するため、非同期処理によってシステム負荷を分散しつつ、迅速かつ安定したインポート を可能にします。
さらに、取込の進捗や処理結果は タスク一覧画面でリアルタイムに確認できる ため、エラーの対応やデータ整合性の確認が容易になります。
これにより、最新の販売データを迅速に反映し、売上分析や在庫管理の精度向上に貢献 します。
業務の流れを止めることなく、効率的な取引情報の管理が可能になります。


### **バックグラウンドタスク機能**
#### **機能概要**  
アップロードされた各種マスタデータおよび伝票データを、バックグラウンドで順番に処理するタスク機能 を提供します。
ユーザーがデータをアップロードすると、登録された順に処理が実行 され、データの一貫性を維持しながらスムーズな運用を可能にします。
主な機能
- アップロードされたデータを順番に処理
データの登録順にタスクを実行することで、適切な順序で情報を反映 できます。
- 非同期処理による負荷分散
大量のデータを扱う際、システムのパフォーマンスを維持しながら効率的に処理 できます。
- 定期的な処理実行
アップロード後、自動的にタスクが動作し、ユーザーの操作を妨げることなくデータを取り込むことができます。

